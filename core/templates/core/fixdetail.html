{% extends 'core/base.html' %}
{% load staticfiles %}
{% load aux_tags %}
{% block titulo %}
	{% if fixie.resolvido %}
		{{ fixie.titulo }} [Resolvido] - Fixcode
	{% else %}
		{{ fixie.titulo }} - Fixcode
	{% endif %}
{% endblock %}
{% block user %}{{user.first_name}}{% endblock %}
{% block verperfil %}{% url 'core:profile' user.username %}{% endblock %}

{% block imagemperfil %}
	{% if eu.imagem_perfil %}
		<a href="{% url 'core:profile' user.username %}"><img src="{{ eu.imagem_perfil.url }}" class="navbar-brand img-circle" alt="imgperfil"></a>
	{% else %}
		<a href="{% url 'core:profile' user.username %}"><img src="{% static 'core/imagens/default.png' %}" class="navbar-brand img-circle" alt="imgperfil"></a>
		
	{% endif %}
{% endblock %}

{% block body %}

<div class="container">
	<div class="row">
		<div class="col-xs-12">
			<div class="panel panel-default">
				<div class="panel-body">
				<div class="media-left media-top">
				    {% if fixie.user|imagemperfil %}
					<img class="thumbnail media-object" src="{{ fixie.user|imagemperfil }}" width="100" height="100">
					{% else %}
					<img class="thumbnail media-object" src="{% static 'core/imagens/default.png' %}" width="100" height="100">
					{% endif %}
				</div>
				<div class="media-body">
				    <h4 class="media-heading"><a class="titulopindex" href="{% url 'core:profile' fixie.user.username %}">{{ fixie.user.first_name }}</a> - <span class="pCinzaUser">{{fixie.user.username}}</span></h4>
				    <small class="pCinza"><span class="glyphicon glyphicon-time"></span> 
				    	
				  			Publicado em {{ fixie.data}}
				  		
				  		- <span class="glyphicon glyphicon-tags"></span>
				  		{% for tag in fixie.area.all %}
				  			{% if tag == fixie.area.all.last %}
				  				&nbsp;<a class="pCinza" href="#">{{ tag }}</a>.
				  			{% else %}
				  				&nbsp;<a class="pCinza" href="#">{{ tag }}</a>,
				  			{% endif %}
				  		{% endfor %}
				  		{% if fixie.resolvido %}
				  			&nbsp;- <span class="glyphicon glyphicon-ok"></span>
				  			Resolvido
				  		{% endif %}

				    </small>
				    <h3>{{ fixie.titulo }}</h3>
				    <div class="fcc col-xs-10">{{ fixie.descricao|safe }}</div>

				    	
				    {% if chave %}
						<a href="#" onclick="alertDelete('{{fixie.pk}}')">Deletar fix</a>
						{% if fixie.ativa_notificacao == True %}
							<a href="#" id="seg" onclick="getNotifyMyFix('{{ fixie.pk }}')">Desativar notificações</a>
						{% else %}
							<a href="#" id="seg" onclick="getNotifyMyFix('{{ fixie.pk }}')">Ativar notificações</a>
						{% endif %}
					{% endif %}

					{% if aviso %}
						<h4>{{ aviso }}</h4>
					{% endif %}

					{% if coments %}
						<h4>Há {{ coments|l }} respostas para este fix:</h4>

						{% for com in coments %}
							{% if com.melhor_resposta %}
								<div style="background-color: yellow;">
									<p>MELHOR RESPOSTA ESCOLHIDA PELO AUTOR:</p>
									<p>...................</p>
									<p><i>{{ com.coment|safe }}</i></p>
									<p>publicado por: {{ com.user.first_name }}</p>
									<p>data: {{ com.data }}</p>
									<p>....................</p>
								</div>
								
							{% endif %}		
						{% endfor %}

						{% if chave_fav is 1 %}
							<p><a href="#" id="fav" onclick="requisicaoFavorite('{{ fixie.pk }}')">Desfavoritar Fix</a></p>
						{% elif chave_fav is 2 %}
							<p><a href="#" id="fav" onclick="requisicaoFavorite('{{ fixie.pk }}')">Favoritar Fix</a></p>
						{% endif %}

						{% if chave_de_participacao == 1 %}
							<p><a href="#" id="par" onclick="requisicaoNotificacaoParticipacao('{{ fixie.pk }}')">Desativar notificação de participação</a></p>
							<p><a href="#" onclick="deleteparticipation('{{ fixie.pk }}')">Excluir participação</a></p>
						{% elif chave_de_participacao == 2 %}
							<p><a href="#" id="par" onclick="requisicaoNotificacaoParticipacao('{{ fixie.pk }}')">Ativar notificação de participação</a></p>
							<p><a href="#" onclick="deleteparticipation('{{ fixie.pk }}')">Excluir participação</a></p>
						{% endif %}



						{% if chave %}
							{% if fixie.resolvido %}
								<p>Este fix está resolvido! - <a href="#" onclick="restore('{{ fixie.pk }}')">Restaurar fix</a></p> 
							{% else %}
								{% if coments.counter != 0 %}
									<a href="#" onclick="fixed('{{ fixie.pk }}')">Marcar fix como resolvido</a> (Esta opção irá desabilitar novas respostas)
								{% endif %}
							{% endif %}
							
							{% for com in coments %}
								<p>...................</p>
								
								<p>
								{% if com.user|imagemperfil %}
								<img src="{{ com.user|imagemperfil }}" width="100" height="100">
								{% else %}
								<img src="{% static 'core/imagens/default.png' %}" width="100" height="100">
								{% endif %}
								<a href="{% url 'core:profile' com.user.username %}">{{ com.user.first_name }}</a></p>
								<p><i>{{ com.coment|safe }}</i> - <a href="" onclick="best_answer('{{ com.pk }}')">Escolher como solução</a> <div id="best{{com.id}}"></div></p>
								<p>data: {{ com.data }}</p>
								{% if com.user != request.user %}
									<p><a href="" onclick="report('{{ com.pk }}')"">Reportar resposta</a></p>
								{% endif %}
								<p>....................</p>
							{% endfor %}
						{% else %}
							{% for com in coments %}
								<p>...................</p>
								<p>
								{% if com.user|imagemperfil %}
								<img src="{{ com.user|imagemperfil }}" width="100" height="100">
								{% else %}
								<img src="{% static 'core/imagens/default.png' %}" width="100" height="100">
								{% endif %}
								<a href="{% url 'core:profile' com.user.username %}">{{ com.user.first_name }}</a></p>
								<p><i>{{ com.coment|safe }}</i></p>
								<p>data: {{ com.data }}</p>
								<p>....................</p>
							{% endfor %}
						{% endif %}


					{% else %}
						<p>Ainda não nenhuma resposta</p>
					{% endif %}

					{% if fixie.resolvido == False %}
						<div id="post"></div>
						<form method="post">
						{% csrf_token %}
						{% for field in form %}
							{{ field.errors }}
							{{ field.label_tag }}
							<br>
							{{ field }}
							<br><br>
						{% endfor %}
						<button type="submit">Responder</button>
					{% endif %}
				    	
				    	
				    
				</div>
				</div>
			</div>
		</div>
	</div>
</div>


--------------------------------------------------------------------------------

	<h1>{{ fixie.titulo }}</h1>
<h3>por {{ fixie.user.first_name }} - publicado em {{ fixie.data }}</h3>
<span>{{ fixie.descricao|safe }}</span>
<p>Tags: {{ fixie.area.all }}</p><br>

{% if chave %}
	<a href="#" onclick="alertDelete('{{fixie.pk}}')">Deletar fix</a>
	{% if fixie.ativa_notificacao == True %}
		<a href="#" id="seg" onclick="getNotifyMyFix('{{ fixie.pk }}')">Desativar notificações</a>
	{% else %}
		<a href="#" id="seg" onclick="getNotifyMyFix('{{ fixie.pk }}')">Ativar notificações</a>
	{% endif %}
{% endif %}

{% if aviso %}
	<h4>{{ aviso }}</h4>
{% endif %}

{% if coments %}
	<h4>Há {{ coments|l }} respostas para este fix:</h4>

	{% for com in coments %}
		{% if com.melhor_resposta %}
			<div style="background-color: yellow;">
				<p>MELHOR RESPOSTA ESCOLHIDA PELO AUTOR:</p>
				<p>...................</p>
				<p><i>{{ com.coment|safe }}</i></p>
				<p>publicado por: {{ com.user.first_name }}</p>
				<p>data: {{ com.data }}</p>
				<p>....................</p>
			</div>
			
		{% endif %}		
	{% endfor %}

	{% if chave_fav is 1 %}
		<p><a href="#" id="fav" onclick="requisicaoFavorite('{{ fixie.pk }}')">Desfavoritar Fix</a></p>
	{% elif chave_fav is 2 %}
		<p><a href="#" id="fav" onclick="requisicaoFavorite('{{ fixie.pk }}')">Favoritar Fix</a></p>
	{% endif %}

	{% if chave_de_participacao == 1 %}
		<p><a href="#" id="par" onclick="requisicaoNotificacaoParticipacao('{{ fixie.pk }}')">Desativar notificação de participação</a></p>
		<p><a href="#" onclick="deleteparticipation('{{ fixie.pk }}')">Excluir participação</a></p>
	{% elif chave_de_participacao == 2 %}
		<p><a href="#" id="par" onclick="requisicaoNotificacaoParticipacao('{{ fixie.pk }}')">Ativar notificação de participação</a></p>
		<p><a href="#" onclick="deleteparticipation('{{ fixie.pk }}')">Excluir participação</a></p>
	{% endif %}



	{% if chave %}
		{% if fixie.resolvido %}
			<p>Este fix está resolvido! - <a href="#" onclick="restore('{{ fixie.pk }}')">Restaurar fix</a></p> 
		{% else %}
			{% if coments.counter != 0 %}
				<a href="#" onclick="fixed('{{ fixie.pk }}')">Marcar fix como resolvido</a> (Esta opção irá desabilitar novas respostas)
			{% endif %}
		{% endif %}
		
		{% for com in coments %}
			<p>...................</p>
			
			<p>
			{% if com.user|imagemperfil %}
			<img src="{{ com.user|imagemperfil }}" width="100" height="100">
			{% else %}
			<img src="{% static 'core/imagens/default.png' %}" width="100" height="100">
			{% endif %}
			<a href="{% url 'core:profile' com.user.username %}">{{ com.user.first_name }}</a></p>
			<p><i>{{ com.coment|safe }}</i> - <a href="" onclick="best_answer('{{ com.pk }}')">Escolher como solução</a> <div id="best{{com.id}}"></div></p>
			<p>data: {{ com.data }}</p>
			{% if com.user != request.user %}
				<p><a href="" onclick="report('{{ com.pk }}')"">Reportar resposta</a></p>
			{% endif %}
			<p>....................</p>
		{% endfor %}
	{% else %}
		{% for com in coments %}
			<p>...................</p>
			<p>
			{% if com.user|imagemperfil %}
			<img src="{{ com.user|imagemperfil }}" width="100" height="100">
			{% else %}
			<img src="{% static 'core/imagens/default.png' %}" width="100" height="100">
			{% endif %}
			<a href="{% url 'core:profile' com.user.username %}">{{ com.user.first_name }}</a></p>
			<p><i>{{ com.coment|safe }}</i></p>
			<p>data: {{ com.data }}</p>
			<p>....................</p>
		{% endfor %}
	{% endif %}


{% else %}
	<p>Ainda não nenhuma resposta</p>
{% endif %}

{% if fixie.resolvido == False %}
	<div id="post"></div>
	<form method="post">
	{% csrf_token %}
	{% for field in form %}
		{{ field.errors }}
		{{ field.label_tag }}
		<br>
		{{ field }}
		<br><br>
	{% endfor %}
	<button type="submit">Responder</button>
{% endif %}


	<script src="{% static 'core/js/main.js' %}"></script>
	<script type="text/javascript" src="{% static 'ckeditor/ckeditor/ckeditor.js' %}"></script>
    <script type="text/javascript" src="{% static 'ckeditor/ckeditor-init.js' %}"></script>
    <script src="{% static 'core/js/countChecks.js' %}"></script>
{% endblock %}


